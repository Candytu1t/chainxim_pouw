# ======================================================================
# PoUW (Proof of Useful Work) consensus configuration file
# 
# This file contains all parameter settings for the PoUW blockchain simulation
# PoUW is a consensus mechanism combining traditional PoW with mathematical optimization
# ======================================================================

[BatchSettings]
batch_enable = true
max_cores = 6
mlist = [20]
nlist = [20]       ; number of miners n
Nlist = [2]         ; optimization dimension N
task_numlist = [7,8,9]
confirm_depths = [2]
adver_nums = [0]
retry_list = [20]
yuzhis = [0.1]
yuzhi_changes = [1]
iterations = 1
optimization_method = [threshold, kkt]

[EnvironmentSettings]
# Basic simulation environment settings
; total_height=1000
; Total block height generated before simulation stops.
; Total rounds before simulation stops.
total_round = 200000
; Set the style of process bar: round/height
process_bar_type = round
; Total miner number in network.
miner_num = 10
; Block size in MB. Only effective when dataitem_enable=False and network_type is TopologyNetwork or AdhocNetwork.
blocksize = 2
; The consensus class imported during simulation.
; VirtualPoW means a lightweight simulation mode, which replaces hash calculation with random number.
; SolidPoW means a strict simulation mode, where RandomOracle is used to control the maximum hash times each round.
consensus_type = consensus.PoUW
; The network class imported during simulation.
network_type = network.SynchronousNetwork
; Show figures during simulation.
show_fig = False
log_level = info
; If True, simplify log and result outputs to reduce disk space consumption.
compact_outputfile = False
; If True, evaluate common prefix pdf.
common_prefix_enable = False
; Enable performance analyzer.
performance_analyzer_enable = False
; Enable memory cleanup during/after simulation.
memory_cleanup_enable = False
; When finding the main chain, only the honest miners ranks above the quantile in terms of local chain height will be considered.
; The main chain will be the common prefix of the local chain of the honest miners above the quantile.
; When consensus_miner_quantile=-1, only the longest chain will be considered.
; When consensus_miner_quantile=1, all miners will be considered.
consensus_miner_quantile = -1

[DataItemSettings]
# Data item settings (control data contained in blocks)
; If True, data items will be generated and contained in blocks.
dataitem_enable = False # Whether to enable data items
; The maximum number of data items that a block can contain. max_block_capacity=0 will disable the dataitem mechanism.
max_block_capacity = 10 # Maximum block capacity
; The size of each dataitem in MB.
dataitem_size = 1 # Data item size
; The interval of dataitem input in rounds. dataitem_input_interval=0 will enable a global dataitem queue.
dataitem_input_interval = 0 # Data item input interval

[ConsensusSettings]
# ======================================================================
# Core parameters of the PoUW consensus
# 
# PoUW mining consists of 4 stages:
# Stage 1: Segment Selection — choose to mine TX/PRP/VT blocks
# Stage 2: Optimization — solve a mathematical optimization problem
# Stage 3: Useful PoW — PoW based on optimization results
# Stage 4: Pure PoW — fallback to traditional PoW
# ======================================================================
# Miner hash rate settings
; Average hash rate, the average number of hash operation per round.
q_ave = 1 # Average hash rate
; 'equal': all miners have equal hash rate; 'rand' means q satisfies gaussion distribution.
q_distr = equal # Hash rate distribution (equal = uniform)
# PoW difficulty target (smaller value = higher difficulty, harder to mine)
; A hexadecimal number serving as the target value for PoW hashing puzzles.
target = 03126E978D4FDF3B645A1CAC083126E978D4FDF3B645A1CAC083126E978D4FDF # Stage 1 difficulty: segment selection
target2 = 004189374BC6A7EF9DB22D0E5604189374BC6A7EF9DB22D0E5604189374BC6A7 # Stage 3 difficulty: useful PoW
target3 = 00068DB8BAC710CB295E9E1B089A027525460AA64C2F837B4A2339C0EBEDFA43 # Stage 4 difficulty: pure PoW
; The average number of rounds required for the entire network to generate a block.
; If average_block_time=0, 'target' becomes effective, otherwise, 'target' will be calculated based on 'average_block_time', 'miner_num', and 'q_ave'.
average_block_time = 0 # Average block time (0 = auto)

# Multi-chain architecture settings
N = 11 # Total number of chains (1 Proposer chain + multiple Voter chains)
vtnum = 10 # Number of Voter chains
# Optimization problem parameters
optimization_dimension = 2 # Optimization dimension (2D problem)
search_range = 20 # Variable search range [-20, 20]
task_num = 8 # Number of available optimization tasks
optimization_threshold = 0.001 # Optimization convergence threshold
kkt_threshold = 0.001 # KKT condition threshold
retry_times = 1 # Retry times when optimization fails
# ======================================================================
# Optimization method selection and configuration
# ======================================================================
# optimization_method: criterion for determining optimization success
#   - 'kkt': KKT method — requires satisfying KKT conditions (||grad|| < kkt_threshold)
#            suitable for high-accuracy solutions
#   - 'threshold': Threshold method — new solution should improve beyond a given threshold
#                  suitable for fast convergence
optimization_method = threshold

# Parameters for the threshold method (effective only when optimization_method = threshold)
# threshold_base: Base threshold — controls the acceptance threshold
# threshold_change_rate: Threshold change rate over block height — dynamic difficulty
# threshold_min: Minimum threshold — prevents the task from becoming too easy
threshold_base = 0.1 # Base threshold
threshold_change_rate = 1 # Threshold change rate (0-1)
threshold_min = 0.1 # Minimum threshold

# ======================================================================
# Recommended parameter presets:
# 
# [Quick test] — easier to mine, good for debugging
# target/target2/target3 = FFFFFFFF... (larger values)
# optimization_method = threshold
# 
# [Standard simulation] — balanced difficulty
# target/target2/target3 = 00FFFFFF... (current settings)
# optimization_method = kkt
# 
# [High difficulty] — more realistic blockchain environment
# target/target2/target3 = 0000FFFF... (smaller values)
# optimization_method = kkt
# ======================================================================

[AttackSettings]
# Attack settings (for security analysis)
; Total number of adversaries. adver_num must be set.
adver_num = 0 # Number of adversarial miners
; Attack type defined in attack mode.
attack_type = HonestMining # Attack type (HonestMining = honest mining)

[DeterPropNetworkSettings]
# Deterministic propagation network settings
; Propagation vector. The elements represent 
; the rate of received miners when (1,2,3...) rounds passed.
; The last element must be 1.0 .
prop_vector = [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0]

[StochPropNetworkSettings]
# Stochastic propagation network settings
; Initial receive probability when a block access network.
rcvprob_start = 0.01
; Increment of receive probability per round.
rcvprob_inc = 0.01
; The block propagtion times for different rates of received miners that required statistics. 
stat_prop_times = [0.03, 0.05, 0.08, 0.1, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.93,0.95,0.98, 1.0]

[TopologyNetworkSettings]
# Topology network settings
; coo/adj/rand
; coo: load adjecent matrix in COOrdinate format (from conf/topologies/circular16_coo.csv by default).
; adj: load adjecent matrix (from conf/topologies/default_adj.csv by default).
; rand: randomly generate a network.
init_mode = adj
; The path to the topology file in a csv format that matches 'init_mode' (relative to current path)
topology_path = conf/topologies/default_adj.csv
; Set bandwidth between honest miners and between the honest and adversaries(MB/round)
bandwidth_honest = 5
; Set bandwidth between adversaries(MB/round)
bandwidth_adv = 5
; homogeneous/binomial
; homogeneous: try to keep the degree of each node the same.
; binomial: set up edges with probability ave_degree/(miner_num-1) for each node.
rand_mode = binomial
; If gen_net_approach is'rand', set the average degree.[Only works when gen_net_approach=rand]
ave_degree = 5
; The block propagtion times for different rates of received miners that required statistics. 
stat_prop_times = [0.03, 0.05, 0.08, 0.1, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.93,0.95,0.98, 1.0]
; The outage probability of each link.
outage_prob = 0
; Whether to resume transmission from the outage point; If False, the message will be resent completely in the next round.
enable_resume_transfer = True
; If the network topology can dynamically change.
dynamic = False
; [Only works when dynamic=true]
avg_tp_change_interval = 10
; [Only works when dynamic=true]
edge_remove_prob = 0.05
; [Only works when dynamic=true]
edge_add_prob = 0.1
; [Only works when dynamic=true]
max_allowed_partitions = 1
; Save routing history or not.
save_routing_history = True
; Genarate routing graph at the end of simulation or not. If True, the process may be long; `compact_outputfile` should be `False` to enable `save_routing_graph` to work.
save_routing_graph = False
; Show edge labels on network and routing graph or not. If miner_num is large, graphs with label are hard to see clearly. 
show_label = False

[AdHocNetworkSettings]
# AdHoc network settings
; only rand supportted
init_mode = rand
; If gen_net_approach is'rand', set the average degree.[Only works when gen_net_approach=rand]
ave_degree = 5
; Message segmentation size(MB); The complete message is divided into several segments, with each segment having a propagation time of one round
segment_size = 0.5
; initiate a square region with the specified width
region_width = 100
; communication range
comm_range = 30
; Variance of the movement when position updates in Gaussian random walk. 
move_variance = 5
; The outage probability of each link.
outage_prob = 0
; If large-scale fading is enabled, the segment size will be adjusted automatically according to the fading model.
enable_large_scale_fading = True
; low/medium/high
path_loss_level = medium
; MB/round; The max bandwidth is the bandwidth within the range of comm_range/100. 
; Other bandwidths at different distances are determined by the fading model.
bandwidth_max = 15
; The block propagtion times for different rates of received miners that required statistics. 
stat_prop_times = [0.03, 0.05, 0.08, 0.1, 0.2, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.93,0.95,0.98, 1.0]

